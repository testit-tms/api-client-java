name: Custom Attribute Model Validation

on:
  pull_request:
    branches: [ "*" ]
    paths:
      - 'src/main/java/ru/testit/client/model/CustomAttributeModel.java'

permissions:
  contents: read
  pull-requests: read

jobs:
  validate-custom-attribute-model:
    runs-on: ubuntu-latest
    name: Validate CustomAttributeModel Fields

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Check for required fields in CustomAttributeModel
      run: |
        echo "Checking for required fields in CustomAttributeModel.java..."
        
        FILE_PATH="src/main/java/ru/testit/client/model/CustomAttributeModel.java"
        
        if [ ! -f "$FILE_PATH" ]; then
          echo "‚ùå CustomAttributeModel.java file not found!"
          exit 1
        fi
        
        echo "‚úÖ File found: $FILE_PATH"
        
        # Check for workItemUsage field
        if grep -q "workItemUsage" "$FILE_PATH"; then
          echo "‚úÖ Field 'workItemUsage' found"
          WORKITEM_COUNT=$(grep -c "workItemUsage" "$FILE_PATH")
          echo "   Number of mentions: $WORKITEM_COUNT"
        else
          echo "‚ùå Field 'workItemUsage' not found in file!"
          exit 1
        fi
        
        # Check for testPlanUsage field  
        if grep -q "testPlanUsage" "$FILE_PATH"; then
          echo "‚úÖ Field 'testPlanUsage' found"
          TESTPLAN_COUNT=$(grep -c "testPlanUsage" "$FILE_PATH")
          echo "   Number of mentions: $TESTPLAN_COUNT"
        else
          echo "‚ùå Field 'testPlanUsage' not found in file!"
          exit 1
        fi
        
        # Check for field declarations specifically
        if grep -q "private.*workItemUsage" "$FILE_PATH"; then
          echo "‚úÖ Field declaration 'workItemUsage' found"
        else
          echo "‚ùå Field declaration 'workItemUsage' not found!"
          exit 1
        fi
        
        if grep -q "private.*testPlanUsage" "$FILE_PATH"; then
          echo "‚úÖ Field declaration 'testPlanUsage' found"
        else
          echo "‚ùå Field declaration 'testPlanUsage' not found!"
          exit 1
        fi
        
        echo ""
        echo "üéâ All required fields are present in CustomAttributeModel.java!"
        echo "üìã Verified fields:"
        echo "   - workItemUsage (mentions: $WORKITEM_COUNT)"
        echo "   - testPlanUsage (mentions: $TESTPLAN_COUNT)"
       